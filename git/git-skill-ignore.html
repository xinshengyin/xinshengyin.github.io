<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>新声音</title>
  
  <link href="/assets/css/application.css" rel="stylesheet" type="text/css" media="all">
  <link href="/assets/css/syntax.css" rel="stylesheet" type="text/css" media="all">
  <link href="/assets/css/style.css" rel="stylesheet" type="text/css" media="all">
  <script src="/assets/js/jquery.js"></script>
  <script src="/assets/js/semantic.js"></script>
  <script src="/assets/js/turbolinks.js"></script>
</head>

<body class="">

  <header class="ui borderless attached menu">
  <div class="ui container">
    

    
    <a href="/" class="item">首页</a>
    

    

    
    <a href="/category" class="item">分类</a>
    

    

    
    <a href="/about" class="item">关于我</a>
    

    
  </div>
</header>

<main>
  <div class="ui invisible side">
  <div class="sidebar">
    <div class="ui inverted vertical fluid icon menu">
	<div class="header center link item" id="close_side">
		<i class="content icon"></i>
	</div>
	
	<div class="item ui dropdown">
		<a class="title">
			<i class="alarm outline icon"></i>
			<span>ruby</span>
		</a>
		<div class="menu content">
			
			<a href="/ruby/programer-think-with-product" class="item">工程师的产品观</a>
			
			<a href="/ruby/file-dir-pathname" class="item">理理File/Dir/Pathname（一）</a>
			
			<a href="/ruby/trace-point" class="item">TracePoint介绍</a>
			
			<a href="/ruby/return-break-next" class="item">ruby中的return</a>
			
			<a href="/ruby/ruby-module-position" class="item">如何动态改变某个class的祖先链</a>
			
			<a href="/ruby/object-space" class="item">ObjectSpace介绍</a>
			
			<a href="/ruby/activesupport-notifications-3" class="item">Rails日志实现探索（3）</a>
			
			<a href="/ruby/activesupport-notifications-2" class="item">Rails日志实现探索（2）</a>
			
			<a href="/ruby/activesupport-notifications" class="item">Rails日志实现探索（1）</a>
			
			<a href="/ruby/rails-request" class="item">Rails中的request</a>
			
			<a href="/ruby/rescue-exception" class="item">rescue exception in ruby</a>
			
			<a href="/ruby/ruby-observer-pattern" class="item">设计模式之观察者模式</a>
			
			<a href="/ruby/ruby-require" class="item">require 的故事</a>
			
			<a href="/ruby/ruby-code-and-decode" class="item">ruby中的编码</a>
			
			<a href="/ruby/research-ruby" class="item">研究ruby的一些小技巧</a>
			
			<a href="/ruby/rails-middleware" class="item">Rails中间件</a>
			
			<a href="/ruby/ruby-serialize" class="item">ruby对象的序列化</a>
			
			<a href="/ruby/activesupport-message-verifier" class="item">ActiveSupport宝藏之MessageVerifier</a>
			
			<a href="/ruby/how-to-write-rakefile" class="item">如何写rakefile</a>
			
			<a href="/ruby/ruby-env" class="item">Ruby on Rails 环境及准备</a>
			
			<a href="/ruby/rack-based-app-boot" class="item">基于Rack的项目初始化</a>
			
		</div>
	</div>
	
	<div class="item ui dropdown">
		<a class="title">
			<i class="alarm outline icon"></i>
			<span>git</span>
		</a>
		<div class="menu content">
			
			<a href="/git/remove-git-history" class="item">如何移除某次提交之前的版本历史</a>
			
			<a href="/git/git-sheet" class="item">Git 不常用的好用的命令</a>
			
			<a href="/git/git-skill-ignore" class="item">Git高级技巧之忽略文件</a>
			
		</div>
	</div>
	
	<div class="item ui dropdown">
		<a class="title">
			<i class="alarm outline icon"></i>
			<span>database</span>
		</a>
		<div class="menu content">
			
			<a href="/database/mysql-sheet" class="item">Mysql数据库编码</a>
			
			<a href="/database/migrate-from-mongodb-to-mysql" class="item">从mongodb向mysql迁移数据</a>
			
		</div>
	</div>
	
	<div class="item ui dropdown">
		<a class="title">
			<i class="alarm outline icon"></i>
			<span>about</span>
		</a>
		<div class="menu content">
			
			<a href="/about/ipsec" class="item">搭建ipsec服务</a>
			
		</div>
	</div>
	
</div>
  </div>
  <div class="content">
    <div class="ui basic segment">

<h1 class="ui top attached center aligned header">
  Git高级技巧之忽略文件

  
</h1>

<div class="ui bottom attached segment">
<h1 id="git高级技巧之忽略文件">Git高级技巧之忽略文件</h1>

<h2 id="前言">前言</h2>

<p>前段时间新参与公司的一个项目，由于服务器 ruby 版本管理用的是 rvm，我在本地用的是 rbenv，这两个 ruby 版本管理软件都用到了<code class="highlighter-rouge">.ruby-version</code>作为配置文件，但是语法不一样。
我的需求是在本地改动<code class="highlighter-rouge">.ruby-version</code>这个文件，但是让 git 忽略我在本地的改动。
首先我想到的是使用<code class="highlighter-rouge">.gitignore</code>配置文件，但是使用<code class="highlighter-rouge">.gitignore</code>会将<code class="highlighter-rouge">.ruby-version</code>这个文件删除，这显然不是我想要的结果。
那怎么解决这个问题呢？</p>

<h2 id="git-忽略文件的两个类型">git 忽略文件的两个类型</h2>

<p>git 忽略文件的类型分为：临时忽略，永久忽略两个类型。<code class="highlighter-rouge">.gitignore</code>实际是属于永久忽略一个文件。</p>

<h3 id="git-临时忽略文件">git 临时忽略文件</h3>
<p>命令：<code class="highlighter-rouge">git update-index --assume-unchanged &lt;file&gt;</code></p>

<p>我先在项目下运行 git status，结果是这样的：</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>On branch master
Your branch is up-to-date with <span class="s1">'origin/master'</span>.

Changes not staged <span class="k">for </span>commit:
  <span class="o">(</span>use <span class="s2">"git add &lt;file&gt;..."</span> to update what will be committed<span class="o">)</span>
  <span class="o">(</span>use <span class="s2">"git checkout -- &lt;file&gt;..."</span> to discard changes <span class="k">in </span>working directory<span class="o">)</span>

	modified:   .ruby-version

no changes added to commit <span class="o">(</span>use <span class="s2">"git add"</span> and/or <span class="s2">"git commit -a"</span><span class="o">)</span>
</code></pre>
</div>

<p>然后我运行命令：<code class="highlighter-rouge">git update-index --assume-unchanged .ruby-version</code></p>

<p>改动果然被忽略了：</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>On branch master
Your branch is up-to-date with <span class="s1">'origin/master'</span>.

nothing to commit, working directory clean
</code></pre>
</div>

<p>但是我还是有个疑问，我怎么知道我将哪些文件临时忽略了呢？</p>

<p>命令：<code class="highlighter-rouge">git ls-files -v</code></p>

<p>结果如下：</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>...
H .gitignore
h .ruby-version
H 404.html
...
</code></pre>
</div>

<p>要知道<code class="highlighter-rouge">git ls-files -v</code>这个命令的结果含义，首先需要了解<code class="highlighter-rouge">git ls-files -t</code>，这个命令会列出各个文件的状态。</p>

<p>文件前面那个字母标志的含义如下：</p>
<ul>
  <li>H  cached</li>
  <li>S  skip-worktree</li>
  <li>M  unmerged</li>
  <li>R  removed/deleted</li>
  <li>C  modified/changed</li>
  <li>K  to be killed</li>
  <li>?  other</li>
</ul>

<p><code class="highlighter-rouge">git ls-files -v</code>是<code class="highlighter-rouge">-t</code>的升级版，对应小写字母则表示这个文件是否被临时忽略。</p>

<p>有结就有解，继续跟踪的命令是：<code class="highlighter-rouge">git update-index --no-assume-unchanged &lt;file&gt;</code></p>

<h3 id="永久忽略">永久忽略</h3>

<p>永久忽略一般大家都知道，主要就是<code class="highlighter-rouge">.gitignore</code>的配置，这个配置分为三个级别：</p>
<h4 id="项目中的gitignore文件">项目中的<code class="highlighter-rouge">.gitignore</code>文件</h4>
<p>这个是放在版本库里共享的；</p>
<h4 id="项目中git目录下地infoexclude文件">项目中<code class="highlighter-rouge">.git</code>目录下地<code class="highlighter-rouge">info/exclude</code>文件</h4>
<p>这个是本地针对该项目忽略的，比如我 ruby 的项目用的编辑器会生成一个<code class="highlighter-rouge">.idea</code>的文件夹，就在这里配置忽略；</p>
<h4 id="全局配置">全局配置</h4>
<p>需要在<code class="highlighter-rouge">.gitconfig</code>文件中指定一个全局的配置文件路径，如：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>[core]
	excludesfile = /Users/qin/.gitignore
</code></pre>
</div>
<p>比如 mac 电脑会生成一个<code class="highlighter-rouge">.DS_Store</code>的文件，就适合在这里配置，对所有项目生效。</p>

</div>

</div>
  </div>
</div>
</main>

<footer>
  <div class="ui divider"></div>
  <div class="ui center aligned segment basic">
    <p class="text-center text-muted">&copy; 2017 www.xinshengyin.com All rights reserved.  </p>
    <p class="text-center text-muted">版权所有</p>
  </div>
</footer>


  <script src="/assets/js/footer.js"></script>
  <script type="text/javascript" src="http://tajs.qq.com/stats?sId=39431539" charset="UTF-8"></script>
</body>

</html>
